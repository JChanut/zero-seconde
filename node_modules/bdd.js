/**
 * Created by Alan on 30/07/2015.
 */
db = module.exports = {
    mysql : require('mysql'),
    mySqlClient : null,

    connect : function() {
        this.mySqlClient = this.mysql.createConnection({
            host: "localhost",
            user: "root",
            password: "",
            database: "zero_sec"
        });
        this.mySqlClient.connect();
    },

    close : function () {
        this.mySqlClient.end();
    },


    SQLcheckLogin : function(username, password, callback){
        var req = 'SELECT id, fonction FROM zs_utilisateur WHERE identifiant = "' + username + '" AND mot_de_passe ="' + password+ '"';

        this.mySqlClient.query(
            req,callback)

    },

    register : function(cp, password, email) {
        var req = 'INSERT INTO zs_utilisateur(identifiant,mot_de_passe, email) VALUES ?';
        var infos = {
            identifiant: cp,
            mot_de_passe: password,
            email: email
        };
        this.mySqlClient.query(
            req, infos, function(err, result){

            }
        )
    },

    verifExistID : function(cp) {
        var req = 'SELECT id FROM zs_utilisateur WHERE identifiant ="' + cp +'"'

        this.mySqlClient.query(
            req,
            function ID(error, results, fields){
                var result = true;
                var message = "";
                if(results.length > 0){
                    result = false;
                    message = "Cet identifiant est déjà utilisé.";
                }
                return {"result" : result, "message" : message};
            }
        )
    },

    verifExistMail : function(email) {
        var req = 'SELECT id FROM zs_utilisateur WHERE email ="' + email +'"'

        this.mySqlClient.query(
            req,
            function EMAIL(error, results, fields){
                var result = true;
                var message = "";
                if(results.length > 0){
                    result = false;
                    message = "Cette adresse mail est déjà utilisée.";
                }
                return {"result" : result, "message" : message};
            }
        )
    },

    verifExistIDAndMail : function(cp, email){
        var rep = this.mySqlClient.verifExistMail(email);
        if(rep.result) {
            rep = this.mySqlClient.verifExistID(cp);
        }
        return rep;
    },

    insertRetard : function(id_agent,bool_retard, num_train, motif_retard, description_retard){
        var req = 'INSERT INTO zs_historique(id_OD, retard, num_train, motif_retard, description_retard) VALUES ?';
        var infos = {
            id_OD: id_agent,
            retard: bool_retard,
            num_train: num_train,
            motif_retard: motif_retard,
            description_retard: description_retard
        };
        this.mySqlClient.query(
            req, infos, function(err, result){

            }
        )

    }

};